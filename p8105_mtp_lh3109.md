p8105\_mtp\_lh3109
================
Lesi He
2021-10-28

``` r
library(tidyverse)
```

    ## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──

    ## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
    ## ✓ tibble  3.1.4     ✓ dplyr   1.0.7
    ## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
    ## ✓ readr   2.0.1     ✓ forcats 0.5.1

    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(dplyr)
library(readxl)
library(patchwork)
```

## Problem 1

Data Cleaning

``` r
data_df =
  #import data
  read_excel("data/p8105_mtp_data.xlsx", range = "A9:I1230") %>% 
  #clean variable names
  janitor::clean_names() %>% 
  mutate(
    #replace missing value in eop_size_mm with 0
    eop_size_mm = ifelse(is.na(eop_size_mm), 0, eop_size_mm),
    #factor "sex" column
    sex = factor(sex, levels = c("1","0"), labels = c("male", "female")),
    #factor age group
    age_group = factor(age_group, levels = c("2","3","4","5","6","7","8"),
                       labels = c("18-30", "31-40", "41-50", 
                                  "51-60", "6", "7", "8")),
    #combine 6,7,8 factors levels in age group
    age_group = fct_collapse(age_group, "60+" = c("6","7","8")),
    #factor EOP size
    eop_size = factor(eop_size, levels = c("0","1","2","3","4","5")),
    #factor FHP category
    fhp_category = factor(fhp_category, levels = c("0","1","2","3","4"))
    )
```

## Problem 2 Visualization

Figure 3 + 4 improved EEOP: exceeded 10mm in size (group 2-5)

``` r
#remove the variable with labeled "1" in age group
#did not correct it in part 1
data_df  = data_df %>%  drop_na(age_group)

#figure 3 improved
fhp_plot = 
  data_df %>% 
  #select the data that will be used in graphing
  select(sex, age_group, fhp_size_mm) %>%
  #group data by sex and age group
  group_by(sex, age_group) %>% 
  #create plot for the data
  ggplot(aes(y = fhp_size_mm, x = age_group, color = sex)) + 
  #create boxplot to show distribution
  geom_boxplot() +
  #edit x, y axis labels
  ylab("FHP Size (mm)") + 
  xlab("Age Group (years)") +
  #add title
  ggtitle("FHP Size (mm) vs. Age Groups (years)") +
  #move the legend to the bottom
  theme(legend.position = 'bottom') 
  
  
#figure 4 improved  
eeop_plot = 
  data_df %>% 
    #group the data frame by three variables respectively
    group_by(age_group, eop_size, sex) %>% 
    #count the number of eop_size in each group
    count(eop_size) %>% 
    #group the new dataframe by age group and sex
    group_by(age_group, sex) %>% 
    #calculate the rate of each group's EOP
    mutate(rate = n / sum(n) * 100) %>% 
    #calculate the rate of each group's EEOP
    #using 100-rate[1]-rate[2] since rate[5] for some group are missing
    summarise(across(rate), rate = 100 - rate[1] - rate[2]) %>%
    #remove duplicate rate by rows
    distinct(rate) %>%
    #plot the data
    ggplot(aes(x = age_group, y = rate, color = sex, group = sex)) +
    #create line plot with dots
    geom_point() + geom_line() +
    # add x, y axis labels
    ylab("Rate of EEOP (%)") + xlab("Age Group (years)") +
    #add title to the plot
    ggtitle("Rate of EEOP (%) vs. Age Groups (years)") +
    #move the legend to the bottom
    theme(legend.position = 'bottom')

#combine the two plots in to one
fhp_plot + eeop_plot +
  #add title
  plot_annotation(title = 
                "Distribution of FHP and EEOP in different Sex and Age Groups",
                #put the title at center
                theme = theme(plot.title = 
                                element_text(hjust = 0.5, face = "bold")))
```

![](p8105_mtp_lh3109_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

Association between FHP size and EOP size in each age and sex group

``` r
data_df %>% 
  #remove missing values in eop size
  filter(!eop_size_mm == 0) %>% 
  #plot graph for association of eop size and fhp size
  ggplot(aes(x = fhp_size_mm, y = eop_size_mm)) +
  #line graph
  geom_line(color = "steelblue") + 
  #plot graph
  geom_point(alpha = 0.5, color = "steelblue") +
  #create muti-panel by sex and age_group variable
  facet_grid(sex ~ age_group) +
  #modify labels
  xlab("FHP Size (mm)") + 
  ylab("EOP Size (mm)") +
  ggtitle("Assocation between FHP Size and EOP Size in different Sex and Age Groups")
```

![](p8105_mtp_lh3109_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->
